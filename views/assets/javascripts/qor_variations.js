"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?require("jquery"):jQuery)}(function(t){function e(i,a){this.$element=t(i),this.options=t.extend({},e.DEFAULTS,t.isPlainObject(a)&&a),this.init()}var i=window._,a=t(document),n="qor.product.variants",r="enable."+n,s="disable."+n,o="qor.replicator",c="added.qor.replicator",l='.qor-product__property select[data-toggle="qor.chooser"]',h=".qor-product__property-selector",u=".qor-product__table tbody",d=".qor-product__container",p=".qor-fieldset__add",f="qor_variants_id_";return e.prototype={constructor:e,init:function(){var t=this.$element;this.bind(),this.variants={},this.productMetas=[],this.templateData=[],this.templateData=[],this.$tbody=t.find(u),this.$replicatorBtn=t.find(p),this.initMetas()},bind:function(){a.on(c,this.addVariantReplicator.bind(this)),this.$element.on("select2:select select2:unselect",l,this.selectVariants.bind(this))},unbind:function(){},initMetas:function(){var e=this.$element.find("td.qor-product__meta");i.each(e,function(e){this.productMetas.push(t(e).data("inputName"))}.bind(this)),this.setTemplate()},removeSpace:function(t){return t.replace(/\s/g,"")},setTemplate:function(){var t=this.productMetas,e="<tr>";i.each(t,function(t){e=e+"<td>[["+t+"]]</td>"}.bind(this)),this.template=e+"</tr>"},addVariantReplicator:function(t,e,i){e.prop("id",i.variantID),e.attr("variant-data",JSON.stringify(i))},compareVariants:function(t){var e=t.variantID,i=this.$element.find("#"+e);return!!i.length},selectVariants:function(e){var i=t(e.target).closest(h).data("variant-type"),a=e.params.data,n=a.selected,r=a.text||a.title||a.Name,s=i+"s",o={};this.variants[s]=this.variants[s]||[],n?(o[i]=r,this.variants[s].push(o)):(o=this.variants[s].filter(function(t){return t[i]!=r}),this.variants[s]=o),this.renderVariants()},renderVariants:function(){var t=this.variants,e=[];return e=Object.keys(t).filter(function(e){return t[e].length>0}),0===e.length?void this.$tbody.html(""):(this.variantsKey=e,void this.convertVariantsData())},convertVariantsData:function(){var t=this.variants,e=[],a=this.variantsKey;if(i.each(a,function(i){e.push(t[i].length)}),this.templateData=[],1===a.length){var n=t[a[0]];i.each(n,function(t){var e=i.keys(t)[0],a=t[e],n={};n[e]=a,n.variantID=""+f+a.replace(/\s/g,""),this.templateData.push(n)}.bind(this))}else this.handleMultipleVariantsData(e,this.generateData.bind(this));this.renderVariantsTable()},renderVariantsTable:function(){var t=this.$tbody,e=this.template,a=this.templateData;this.replicator=this.replicator||this.$element.find(d).data(o),t.html(""),i.each(a,function(i){t.append(window.Mustache.render(e,i)),this.compareVariants(i)||this.replicator.add(null,this.$replicatorBtn,i)}.bind(this))},generateData:function(t){for(var e=this.variantsKey,a=this.variants,n=void 0,r={},s=0,o=t.length;s<o;s++)r=Object.assign({},r,a[e[s]][t[s]]);n=i.values(r).map(this.removeSpace),r.variantID=""+f+n.join("_"),this.templateData.push(r)},handleMultipleVariantsData:function(t,e){this.convertMultipleVariantsData(t,e,[],0)},convertMultipleVariantsData:function(t,e,i,a){if(0==t.length)e(i);else{var n=t.slice(1);for(i[a]=0;i[a]<t[0];++i[a])this.convertMultipleVariantsData(n,e,i,a+1)}},destroy:function(){this.unbind(),this.$element.removeData(n)}},e.plugin=function(i){return this.each(function(){var a=t(this),r=a.data(n),s=void 0;if(!r){if(/destroy/.test(i))return;a.data(n,r=new e(this,i))}"string"==typeof i&&t.isFunction(s=r[i])&&s.apply(r)})},t(function(){var i='[data-toggle="qor.product.variants"]';t(document).on(s,function(a){e.plugin.call(t(i,a.target),"destroy")}).on(r,function(a){e.plugin.call(t(i,a.target))}).triggerHandler(r)}),e});