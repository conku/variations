"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?require("jquery"):jQuery)}(function(t){function e(n,a){this.$element=t(n),this.options=t.extend({},e.DEFAULTS,t.isPlainObject(a)&&a),this.init()}var n=window._,a="qor.product.variants",i="enable."+a,r="disable."+a,s='.qor-product__property select[data-toggle="qor.chooser"]',o=".qor-product__property-selector",u=".qor-product__table table tbody";return e.prototype={constructor:e,init:function(){this.bind(),this.variants={},this.productMetas=[],this.templateData=[],this.templateData=[],this.$tbody=this.$element.find(u),this.initMetas()},bind:function(){this.$element.on("select2:select",s,this.selectVariants.bind(this))},unbind:function(){},initMetas:function(){var e=this.$element.find("td.qor-product__meta");n.each(e,function(e){this.productMetas.push(t(e).data("inputName"))}.bind(this)),this.setTemplate()},setTemplate:function(){var t=this.productMetas,e="<tr>";n.each(t,function(t){e=e+"<td>[["+t+"]]</td>"}.bind(this)),this.template=e+"</tr>"},selectVariants:function(e){var n=t(e.target).closest(o).data("variant-type"),a=e.params.data,i=a.text||a.title||a.Name,r=n+"s",s={};s[n]=i,this.variants[r]=this.variants[r]||[],this.variants[r].push(s),this.renderVariants()},renderVariants:function(){var t=this.variants,e=[];e=Object.keys(t).filter(function(e){return t[e].length>0}),0!==e.length&&(this.variantsHasValueKey=e,this.convertVariantsData())},convertVariantsData:function(){var t=this.variants,e=[],a=this.variantsHasValueKey;n.each(a,function(n){e.push(t[n].length)}),1===a.length?this.templateData=t[a[0]]:(this.templateData=[],this.handleMultipleVariantsData(e,this.generateData.bind(this))),this.renderVariantsTable()},renderVariantsTable:function(){var t=this.$tbody,e=this.template,a=this.templateData;t.html(""),n.each(a,function(n){t.append(window.Mustache.render(e,n))})},generateData:function(t){for(var e=this.variantsHasValueKey,n=this.variants,a={},i=0,r=t.length;i<r;i++)a=Object.assign({},a,n[e[i]][t[i]]);this.templateData.push(a)},handleMultipleVariantsData:function(t,e){this.convertMultipleVariantsData(t,e,[],0)},convertMultipleVariantsData:function(t,e,n,a){if(0==t.length)e(n);else{var i=t.slice(1);for(n[a]=0;n[a]<t[0];++n[a])this.convertMultipleVariantsData(i,e,n,a+1)}},destroy:function(){this.unbind(),this.$element.removeData(a)}},e.plugin=function(n){return this.each(function(){var i,r=t(this),s=r.data(a);if(!s){if(/destroy/.test(n))return;r.data(a,s=new e(this,n))}"string"==typeof n&&t.isFunction(i=s[n])&&i.apply(s)})},t(function(){var n='[data-toggle="qor.product.variants"]';t(document).on(r,function(a){e.plugin.call(t(n,a.target),"destroy")}).on(i,function(a){e.plugin.call(t(n,a.target))}).triggerHandler(i)}),e});