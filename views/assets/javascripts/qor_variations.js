"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?require("jquery"):jQuery)}(function(t){function e(i,n){this.$element=t(i),this.options=t.extend({},e.DEFAULTS,t.isPlainObject(n)&&n),this.init()}var i=window._,n=t(document),a="qor.product.variants",r="enable."+a,s="disable."+a,o="qor.replicator",c="added.qor.replicator",l='.qor-product__property select[data-toggle="qor.chooser"]',u=".qor-product__property-selector",d=".qor-product__table tbody",h=".qor-product__container",p=".qor-fieldset__add";return e.prototype={constructor:e,init:function(){var t=this.$element;this.bind(),this.variants={},this.productMetas=[],this.templateData=[],this.templateData=[],this.$tbody=t.find(d),this.replicator=t.find(h).data(o),this.$replicatorBtn=t.find(p),this.initMetas()},bind:function(){n.on(c,this.addVariantReplicator.bind(this)),this.$element.on("select2:select select2:unselect",l,this.selectVariants.bind(this))},unbind:function(){},initMetas:function(){var e=this.$element.find("td.qor-product__meta");i.each(e,function(e){this.productMetas.push(t(e).data("inputName"))}.bind(this)),this.setTemplate()},setTemplate:function(){var t=this.productMetas,e="<tr>";i.each(t,function(t){e=e+"<td>[["+t+"]]</td>"}.bind(this)),this.template=e+"</tr>"},addVariantReplicator:function(t,e){},selectVariants:function(e){var i=t(e.target).closest(u).data("variant-type"),n=e.params.data,a=n.selected,r=n.text||n.title||n.Name,s=i+"s",o={};this.variants[s]=this.variants[s]||[],a?(o[i]=r,this.variants[s].push(o)):(o=this.variants[s].filter(function(t){return t[i]!=r}),this.variants[s]=o),this.renderVariants()},renderVariants:function(){var t=this.variants,e=[];return e=Object.keys(t).filter(function(e){return t[e].length>0}),0===e.length?void this.$tbody.html(""):(this.variantsHasValueKey=e,void this.convertVariantsData())},convertVariantsData:function(){var t=this.variants,e=[],n=this.variantsHasValueKey;i.each(n,function(i){e.push(t[i].length)}),1===n.length?this.templateData=t[n[0]]:(this.templateData=[],this.handleMultipleVariantsData(e,this.generateData.bind(this))),this.renderVariantsTable()},renderVariantsTable:function(){var t=this.$tbody,e=this.template,n=this.templateData;t.html(""),i.each(n,function(i){t.append(window.Mustache.render(e,i))}.bind(this))},generateData:function(t){for(var e=this.variantsHasValueKey,i=this.variants,n={},a=((Math.random()+1).toString(36).substring(7),0),r=t.length;a<r;a++)n=Object.assign({},n,i[e[a]][t[a]]);this.templateData.push(n)},handleMultipleVariantsData:function(t,e){this.convertMultipleVariantsData(t,e,[],0)},convertMultipleVariantsData:function(t,e,i,n){if(0==t.length)e(i);else{var a=t.slice(1);for(i[n]=0;i[n]<t[0];++i[n])this.convertMultipleVariantsData(a,e,i,n+1)}},destroy:function(){this.unbind(),this.$element.removeData(a)}},e.plugin=function(i){return this.each(function(){var n=t(this),r=n.data(a),s=void 0;if(!r){if(/destroy/.test(i))return;n.data(a,r=new e(this,i))}"string"==typeof i&&t.isFunction(s=r[i])&&s.apply(r)})},t(function(){var i='[data-toggle="qor.product.variants"]';t(document).on(s,function(n){e.plugin.call(t(i,n.target),"destroy")}).on(r,function(n){e.plugin.call(t(i,n.target))}).triggerHandler(r)}),e});