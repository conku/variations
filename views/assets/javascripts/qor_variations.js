"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?require("jquery"):jQuery)}(function(t){function e(a,n){this.$element=t(a),this.options=t.extend({},e.DEFAULTS,t.isPlainObject(n)&&n),this.init()}var a=window._,n="qor.product.variants",i="enable."+n,s="disable."+n,r='.qor-product__property select[data-toggle="qor.chooser"]',o=".qor-product__property-selector",l=".qor-product__table table tbody";return e.prototype={constructor:e,init:function(){this.bind(),this.variants={},this.productMetas=[],this.templateData=[],this.templateData=[],this.$tbody=this.$element.find(l),this.initMetas()},bind:function(){this.$element.on("select2:select",r,this.selectVariants.bind(this))},unbind:function(){},initMetas:function(){var e=this.$element.find("td.qor-product__meta");a.each(e,function(e){this.productMetas.push(t(e).data("inputName"))}.bind(this)),this.setTemplate()},setTemplate:function(){var t=this.productMetas,e="<tr>";a.each(t,function(t){e=e+"<td>[["+t+"]]</td>"}.bind(this)),this.template=e+"</tr>"},selectVariants:function(e){var a=t(e.target).closest(o).data("variant-type"),n=e.params.data,i=n.text||n.title||n.Name,s=a+"s",r={};r[a]=i,this.variants[s]=this.variants[s]||[],this.variants[s].push(r),this.renderVariants()},renderVariants:function(){var t=this.variants,e=[];e=a.filter(Object.keys(t),function(e){return t[e].length>0}),0!==e.length&&(this.variantsHasValueKey=e,this.convertVariantsData())},renderVariantsTable:function(){var t=this.$tbody,e=this.template,n=this.templateData;t.html(""),console.log(this.templateData),a.each(n,function(a){t.append(window.Mustache.render(e,a))})},convertVariantsData:function(){var t=this.variants,e=[],a=this.variantsHasValueKey;a.forEach(function(a){e.push(t[a].length)}),1===a.length?this.templateData=t[a[0]]:(this.templateData=[],this.handleMultipleVariantsData(e,this.generateData.bind(this))),this.renderVariantsTable()},generateData:function(t){for(var e=this.variantsHasValueKey,a=this.variants,n={},i=0,s=t.length;s>i;i++)n=Object.assign({},n,a[e[i]][t[i]]);this.templateData.push(n)},handleMultipleVariantsData:function(t,e){this.convertMultipleVariantsData(t,e,[],0)},convertMultipleVariantsData:function(t,e,a,n){if(0==t.length)e(a);else{var i=t.slice(1);for(a[n]=0;a[n]<t[0];++a[n])this.convertMultipleVariantsData(i,e,a,n+1)}},destroy:function(){this.unbind(),this.$element.removeData(n)}},e.plugin=function(a){return this.each(function(){var i,s=t(this),r=s.data(n);if(!r){if(/destroy/.test(a))return;s.data(n,r=new e(this,a))}"string"==typeof a&&t.isFunction(i=r[a])&&i.apply(r)})},t(function(){var a='[data-toggle="qor.product.variants"]';t(document).on(s,function(n){e.plugin.call(t(a,n.target),"destroy")}).on(i,function(n){e.plugin.call(t(a,n.target))}).triggerHandler(i)}),e});